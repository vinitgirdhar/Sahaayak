{% extends "base.html" %}

{% block title %}Add Product - Sahaayak{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto">
    <div class="flex items-center mb-8">
        <a href="{{ url_for('main.wholesaler_dashboard') }}" 
           class="text-blue-600 hover:text-blue-800 mr-4">← Back to Dashboard</a>
        <h2 class="text-3xl font-bold text-gray-800">Add New Product</h2>
    </div>
    
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="mb-4 p-4 rounded-lg bg-green-100 text-green-700">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}
    
    <form method="POST" enctype="multipart/form-data" class="bg-white shadow-md rounded-lg p-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Category Selection - Categories aligned with vendor dashboard -->
            <div class="md:col-span-2">
                <label class="block text-sm font-medium text-gray-700 mb-2">Product Category *</label>
                <select id="categorySelect" name="main_category" required 
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                        onchange="updateSubcategories()">
                    <option value="">Select Main Category</option>
                    <option value="Vegetables">Fresh Vegetables</option>
                    <option value="Dry Ingredients">Dry Ingredients & Staples</option>
                    <option value="Spices & Condiments">Spices & Seasonings</option>
                    <option value="Dairy Products">Dairy Products</option>
                    <option value="Bread & Bakery">Bread & Bakery</option>
                    <option value="Ready-to-Eat">Ready-to-Eat Meals</option>
                    <option value="Oils & Condiments">Oils & Condiments</option>
                    <option value="Spreads & Pantry">Spreads & Pantry Items</option>
                    <option value="Snacks & Beverages">Snacks & Beverages</option>
                    <option value="Grains & Cereals">Grains & Cereals</option>
                    <option value="Other">Packaging, Desserts & Other</option>
                </select>
            </div>
            
            <!-- Subcategory Selection -->
            <div class="md:col-span-2" id="subcategoryContainer" style="display: none;">
                <label class="block text-sm font-medium text-gray-700 mb-2">Product Type *</label>
                <select id="subcategorySelect" name="subcategory" 
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                        onchange="updateProductName()">
                    <option value="">Select Product Type</option>
                </select>
            </div>
            
            <!-- Product Name -->
            <div class="md:col-span-2">
                <label class="block text-sm font-medium text-gray-700 mb-2">Product Name *</label>
                <input type="text" id="productName" name="name" required 
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                       placeholder="Product name will be auto-filled based on selection">
            </div>
            
            <!-- Price -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Price per Unit (₹) *</label>
                <input type="number" name="price" step="0.01" min="0" required 
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                       placeholder="0.00">
            </div>
            
            <!-- Stock -->
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Stock Quantity *</label>
                <input type="number" name="stock" min="0" required 
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                       placeholder="Available quantity">
            </div>
            
            <!-- Product Image -->
            <div class="md:col-span-2">
                <label class="block text-sm font-medium text-gray-700 mb-2">Product Image</label>
                <input type="file" name="product_image" accept="image/*"
                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                <p class="text-xs text-gray-500 mt-1">Upload product image (optional)</p>
            </div>
        </div>
        
        <!-- Group Buy Eligible -->
        <div class="mt-6">
            <label class="flex items-center">
                <input type="checkbox" name="group_buy_eligible" checked 
                       class="mr-2 h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                <span class="text-sm text-gray-700">Eligible for Group Buying</span>
            </label>
            <p class="text-xs text-gray-500 mt-1">Allow vendors to form buying clubs for bulk orders</p>
        </div>
        
        <div class="mt-6 flex space-x-4">
            <button type="submit" 
                    class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-md transition-colors">
                Add Product
            </button>
            <a href="{{ url_for('main.wholesaler_dashboard') }}" 
               class="flex-1 bg-gray-300 hover:bg-gray-400 text-gray-700 text-center py-2 px-4 rounded-md transition-colors">
                Cancel
            </a>
        </div>
    </form>
</div>

<script>
// Product categories and subcategories data structure - aligned with vendor dashboard categories
const productCategories = {
    "Vegetables": [
        "Organic Tomatoes", "Fresh Spinach", "Premium Carrots", "Red Onions", "Green Capsicum",
        "Fresh Broccoli", "Cauliflower", "Green Beans", "Cabbage", "Cucumber",
        "Lady Finger (Okra)", "Bitter Gourd", "Bottle Gourd", "Pumpkin", "Radish",
        "Potatoes", "Green Chillies", "Beetroot", "Garlic", "Ginger", "Coriander", "Mint"
    ],
    "Dry Ingredients": [
        "Toor Dal", "Chana Dal", "Moong Dal", "Urad Dal", "Masoor Dal",
        "Rajma (Kidney Beans)", "Kabuli Chana", "Poha (Flattened Rice)", "Suji (Semolina)",
        "Besan (Gram Flour)", "Maida (All Purpose Flour)", "Atta (Whole Wheat)", 
        "Rice Flour", "Corn Flour", "Sabudana"
    ],
    "Spices & Condiments": [
        "Turmeric Powder", "Red Chilli Powder", "Coriander Powder", "Cumin Seeds",
        "Garam Masala", "Biryani Masala", "Pav Bhaji Masala", "Chaat Masala",
        "Black Pepper", "Cinnamon Sticks", "Cardamom", "Cloves", "Bay Leaves",
        "Mustard Seeds", "Fenugreek Seeds", "Asafoetida (Hing)", "Salt"
    ],
    "Dairy Products": [
        "Fresh Milk (1L)", "Paneer (200g)", "Curd/Yogurt (400g)", "Butter (100g)",
        "Cheese Slices (200g)", "Cream (200ml)", "Buttermilk (500ml)", "Ghee (500g)",
        "Mozzarella Cheese", "Condensed Milk", "Skimmed Milk (1L)", "Flavored Yogurt"
    ],
    "Bread & Bakery": [
        "White Bread", "Brown Bread", "Pav (Dinner Rolls)", "Burger Buns",
        "Hot Dog Buns", "Croissant", "Rusk Pack", "Naan", "Roti", "Paratha",
        "Pizza Base", "Garlic Bread"
    ],
    "Ready-to-Eat": [
        "Frozen Samosa", "Frozen Paratha", "Instant Noodles Pack", "Ready Mix Idli",
        "Ready Mix Dosa", "Canned Rajma Masala", "Canned Chole", "Frozen Veg Momos",
        "Instant Poha Mix", "Ready Mix Upma", "Frozen Spring Rolls", "Instant Soup Pack"
    ],
    "Oils & Condiments": [
        "Sunflower Oil (1L)", "Mustard Oil (1L)", "Groundnut Oil (1L)", "Olive Oil (500ml)",
        "Coconut Oil (500ml)", "Sesame Oil (200ml)", "Tomato Ketchup", "Mayonnaise",
        "Soy Sauce", "Vinegar", "Green Chutney", "Tamarind Paste"
    ],
    "Spreads & Pantry": [
        "Peanut Butter", "Jam Mixed Fruit", "Honey", "Nutella", "Cheese Spread",
        "Pickle (Mango)", "Pickle (Mixed)", "Chyawanprash", "Maple Syrup", "Tahini"
    ],
    "Snacks & Beverages": [
        "Chips (Large Pack)", "Namkeen Mix", "Biscuits Variety Pack", "Roasted Peanuts",
        "Makhana (Fox Nuts)", "Dry Fruit Mix", "Tea (250g)", "Coffee (200g)",
        "Green Tea", "Soft Drink (2L)", "Mango Juice (1L)", "Coconut Water (1L)",
        "Energy Drink", "Lassi", "Soda"
    ],
    "Grains & Cereals": [
        "Basmati Rice (1kg)", "Sona Masoori Rice (1kg)", "Brown Rice (1kg)", "Wheat (1kg)",
        "Jowar (Sorghum)", "Bajra (Pearl Millet)", "Ragi (Finger Millet)", "Oats",
        "Muesli", "Corn Flakes", "Quinoa", "Barley"
    ],
    "Other": [
        "Disposable Plates", "Disposable Cups", "Aluminum Foil Roll", "Cling Wrap",
        "Paper Napkins", "Ice Cream", "Gulab Jamun Mix", "Jalebi Mix", "Rasgulla",
        "Chicken Fresh", "Fish Fresh", "Prawns", "Eggs", "Mutton", "Gloves", "Carry Bags"
    ]
};

function updateSubcategories() {
    const categorySelect = document.getElementById('categorySelect');
    const subcategoryContainer = document.getElementById('subcategoryContainer');
    const subcategorySelect = document.getElementById('subcategorySelect');
    const productNameInput = document.getElementById('productName');
    
    const selectedCategory = categorySelect.value;
    
    // Clear previous options
    subcategorySelect.innerHTML = '<option value="">Select Product Type</option>';
    productNameInput.value = '';
    
    if (selectedCategory && productCategories[selectedCategory]) {
        const categoryData = productCategories[selectedCategory];
        
        // Show subcategory container
        subcategoryContainer.style.display = 'block';
        
        // Category data is always a flat array now
        categoryData.forEach(item => {
            const option = document.createElement('option');
            option.value = item;
            option.textContent = item;
            subcategorySelect.appendChild(option);
        });
        
        // Make subcategory required
        subcategorySelect.setAttribute('required', 'required');
    } else {
        // Hide subcategory container
        subcategoryContainer.style.display = 'none';
        subcategorySelect.removeAttribute('required');
    }
}

function updateProductName() {
    const subcategorySelect = document.getElementById('subcategorySelect');
    const productNameInput = document.getElementById('productName');
    
    const selectedSubcategory = subcategorySelect.value;
    
    if (selectedSubcategory) {
        productNameInput.value = selectedSubcategory;
    }
}

// Form validation to ensure both category and subcategory are selected
document.querySelector('form').addEventListener('submit', function(e) {
    const categorySelect = document.getElementById('categorySelect');
    const subcategorySelect = document.getElementById('subcategorySelect');
    
    if (!categorySelect.value) {
        e.preventDefault();
        alert('Please select a product category');
        return;
    }
    
    if (subcategorySelect.style.display !== 'none' && subcategorySelect.hasAttribute('required') && !subcategorySelect.value) {
        e.preventDefault();
        alert('Please select a product type');
        return;
    }
});
</script>
{% endblock %}